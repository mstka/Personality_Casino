<!DOCTYPE html>
<!-- シンプルなフロントエンド -->
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ルーレット</title>
    <link rel="stylesheet" href="style.css">
    </head>
<body>
    <div class="container">
        <h1>ルーレット</h1>
        <p><a href="index.html">ホームに戻る</a></p>
        <label>ベット額: <input id="amount" type="number" min="1" step="1" value="1"></label>
        <div id="options" class="options"></div>
        const options = document.getElementById('options');
        const amountInput = document.getElementById('amount');

        function addBetCell(container, label, type, value, colorClass) {
            const cell = document.createElement('div');
            cell.textContent = label;
            cell.dataset.type = type;
            cell.dataset.value = value;
            if (colorClass) cell.classList.add(colorClass);
            cell.addEventListener('click', () => placeBet(type, value, cell));
            container.appendChild(cell);
        }
            cell.dataset.type = 'number';
            cell.addEventListener('click', () => placeBet('number', n, cell));
        const outside = [
            ['Red', 'color', 'red', 'red'],
            ['Black', 'color', 'black', 'black'],
            ['Even', 'parity', 'even', null],
            ['Odd', 'parity', 'odd', null],
            ['1st 12', 'dozen', '1', null],
            ['2nd 12', 'dozen', '2', null],
            ['3rd 12', 'dozen', '3', null],
            ['Low', 'range', 'low', null],
            ['High', 'range', 'high', null]
        ];
        outside.forEach(o => addBetCell(options, o[0], o[1], o[2], o[3]));

        async function placeBet(type, value, cell) {
            const amount = parseFloat(amountInput.value);
            if (!amount || amount <= 0) {
                alert('金額を入力してください');
                return;
            const bet = { bet_type: type, value: value, amount: amount, token: token };
            try {
                const res = await fetch(`${API_BASE}/place_bet`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(bet)
                });
                const data = await res.json();
                result.textContent = JSON.stringify(data, null, 2);
            } catch (err) {
                console.error(err);
            }
            const chip = document.createElement('div');
            chip.className = 'chip';
            cell.appendChild(chip);
            setTimeout(() => chip.remove(), 2000);
        }
                    board.classList.add('disabled');
                    options.classList.add('disabled');
                    board.classList.remove('disabled');
                    options.classList.remove('disabled');
                const arr = Array.from(selected);
                document.getElementById('value').value = arr.join(',');
                document.getElementById('bet-type').value = arr.length > 1 ? 'multi' : 'number';

            });
            board.appendChild(cell);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = localStorage.getItem('token');
            if (!token) {
                alert('先にログインしてください');
                return;
            }
            let type = document.getElementById('bet-type').value;
            let val = document.getElementById('value').value;
            if (type.startsWith('dozen')) {
                val = type.replace('dozen','');
                type = 'dozen';
            } else if (type === 'low' || type === 'high') {
                val = type;
                type = 'range';
            }
            const bet = {
                bet_type: type,
                value: val,
                amount: parseFloat(document.getElementById('amount').value),
                token: token
            };
            const res = await fetch(`${API_BASE}/place_bet`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bet)
            });
            const data = await res.json();
            result.textContent = JSON.stringify(data, null, 2);
        });

        async function poll() {
            const token = localStorage.getItem('token');
            const url = token ? `${API_BASE}/round_status?token=${token}` : `${API_BASE}/round_status`;
            try {
                const res = await fetch(url);
                const data = await res.json();
                countdown.textContent = `次のスピンまで: ${data.time_remaining}秒`;
                if (data.time_remaining <= 5) {
                    form.querySelector('button').disabled = true;
                } else {
                    form.querySelector('button').disabled = false;
                }
                if (data.result) {
                    wheel.classList.add('spin');
                    setTimeout(() => {
                        wheel.classList.remove('spin');
                        result.textContent = JSON.stringify(data.result, null, 2);
                    }, 2000);
                }
            } catch (err) {
                console.error(err);
            }
        }
        setInterval(poll, 1000);
        poll();
    </script>
</body>
</html>

